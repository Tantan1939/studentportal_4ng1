{% extends 'studentportal/base1.html' %}
{% block content %}
{% load userPortal_tags %}

<!-- Message from messages framework / views.py -->
{% if messages %}
<div class="modal fade show" id="messageModal" tabindex="-1" >
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <div class="messages">
                    {% for message in messages %}
                        <div id="successmessage" {% if message.tags %} class="{{ message.tags }} d-flex justify-content-between align-items-center"{% endif %}>   
                            <h5 class="m-0">{{message}}</h5> 
                            <i class="fa fa-check text-success" aria-hidden="true" style="font-size: 25px;"></i>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
<script>
    var myModal = new bootstrap.Modal(document.getElementById("messageModal"));
    myModal.show(); 
</script>
{% endif %}


<div class="container">
    <div class="col-md-8">
        <form id="form_submit" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <!-- List of errors from forms.py -->
            {{ form.non_field_errors }}
        
            <h4> Personal Information </h4>

            <div class="form-outline mb-4">
                <img src="{{userimage.image.url}}" alt="" id="userpicture" width="60%">
            </div>

            <div class="form-outline mb-4">
                <i class="fas fa-camera" id="openFolder"></i>
                {{ form.image|addclass:"form-control"}} <!-- Input Field -->
                {{ form.image.errors }} <!-- Field errors -->
            </div>

            <div class="form-outline mb-4">
                <label for="{{ form.first_name.id_for_label }}" class="form-label"> {{ form.first_name.label }}: </label>
                {{ form.first_name|addclass:"form-control"}} <!-- Input Field -->
                {{ form.first_name.errors }} <!-- Field errors -->
            </div>

            <div class="form-outline mb-4">
                <label for="{{ form.middle_name.id_for_label }}" class="form-label"> {{ form.middle_name.label }}: </label>
                {{ form.middle_name|addclass:"form-control"}} <!-- Input Field -->
                {{ form.middle_name.errors }} <!-- Field errors -->
            </div>

            <div class="form-outline mb-4">
                <label for="{{ form.last_name.id_for_label }}" class="form-label"> {{ form.last_name.label }}: </label>
                {{ form.last_name|addclass:"form-control"}} <!-- Input Field -->
                {{ form.last_name.errors }} <!-- Field errors -->
            </div>

            <div class="form-outline mb-4">
                <label for="{{ form.birth_date.id_for_label }}" class="form-label"> {{ form.birth_date.label }}: </label>
                {{ form.birth_date|addclass:"form-control"}} <!-- Input Field -->
                {{ form.birth_date.errors }} <!-- Field errors -->
            </div>

            <div class="form-outline mb-4">
                <label for="{{ form.sex.id_for_label }}" class="form-label"> {{ form.sex.label }}: </label>
                {{ form.sex|addclass:"form-control"}} <!-- Input Field -->
                {{ form.sex.errors }} <!-- Field errors -->
            </div>

            <div class="form-outline mb-4">
                <label for="{{ form.userContact.id_for_label }}" class="form-label"> {{ form.userContact.label }}: </label>
                {{ form.userContact|addclass:"form-control"}} <!-- Input Field -->
                {{ form.userContact.errors }} <!-- Field errors -->
            </div>

            <div class="form-outline mb-4">
                <label for="{{ form.userAddress.id_for_label }}" class="form-label"> {{ form.userAddress.label }}: </label>
                {{ form.userAddress|addclass:"form-control"}} <!-- Input Field -->
                {{ form.userAddress.errors }} <!-- Field errors -->
            </div>

            <input type="submit" value="Update" class="btn btn-primary btn-block mb-4">

        </form>
        <a href="{% url 'usersPortal:account_profile' %}" class="btn btn-primary"> Back </a>
    </div>
</div>

<script>
    $('#form_submit').one('submit', function() {
        $(this).find('input[type="submit"]').attr('disabled','disabled');
    });

    $(document).ready(function(){
        $("#openFolder").click(function(){
            $("#id_image").trigger('click');
        });

        $("#id_image").change(function () {
            var ext = $('#id_image').val().split('.').pop().toLowerCase();
            if($.inArray(ext, ['png','jpg','jpeg']) == -1) {
                $("#id_image").val("");
                $("#userpicture").attr("src", "");
                alert('You can only upload jpg/png file.');
            }else{
                const file = this.files[0];
                if (file) {
                    let reader = new FileReader();
                    reader.onload = function (event) {
                    $("#userpicture")
                    .attr("src", event.target.result);
                };
                    reader.readAsDataURL(file);
                }
            }
        });
    });
</script>

{% endblock content %}